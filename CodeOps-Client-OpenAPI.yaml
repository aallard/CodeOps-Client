openapi: 3.0.3
info:
  title: CodeOps-Client Consumed APIs
  description: |
    OpenAPI specification documenting the REST APIs consumed by CodeOps-Client.
    This is a client-side spec — it describes the endpoints the Flutter desktop
    application calls on CodeOps-Server, CodeOps-Vault, GitHub, and Jira.
  version: 1.0.0
  contact:
    name: CodeOps

servers:
  - url: http://localhost:8090/api/v1
    description: CodeOps-Server (development)
  - url: http://localhost:8097/api/v1/vault
    description: CodeOps-Vault (development)

security:
  - bearerAuth: []

paths:
  # ═══════════════════════════════════════════════════════════════
  # AUTH ENDPOINTS (ApiClient)
  # ═══════════════════════════════════════════════════════════════
  /auth/login:
    post:
      tags: [Auth]
      summary: Authenticate user
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: JWT tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  userId:
                    type: string
                    format: uuid

  /auth/register:
    post:
      tags: [Auth]
      summary: Register new user
      operationId: register
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, displayName]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                displayName:
                  type: string
      responses:
        '200':
          description: JWT tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  userId:
                    type: string
                    format: uuid

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh access token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: New JWT tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string

  /auth/change-password:
    put:
      tags: [Auth]
      summary: Change password
      operationId: changePassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [currentPassword, newPassword]
              properties:
                currentPassword:
                  type: string
                newPassword:
                  type: string
      responses:
        '200':
          description: Password changed

  # ═══════════════════════════════════════════════════════════════
  # USER ENDPOINTS (UserApi)
  # ═══════════════════════════════════════════════════════════════
  /users/me:
    get:
      tags: [Users]
      summary: Get current user profile
      operationId: getCurrentUser
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/{id}:
    get:
      tags: [Users]
      summary: Get user by ID
      operationId: getUserById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    put:
      tags: [Users]
      summary: Update user profile
      operationId: updateUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                displayName:
                  type: string
                avatarUrl:
                  type: string
      responses:
        '200':
          description: Updated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/search:
    get:
      tags: [Users]
      summary: Search users
      operationId: searchUsers
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

  /users/{id}/deactivate:
    put:
      tags: [Users]
      summary: Deactivate user
      operationId: deactivateUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Deactivated

  /users/{id}/activate:
    put:
      tags: [Users]
      summary: Activate user
      operationId: activateUser
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Activated

  # ═══════════════════════════════════════════════════════════════
  # TEAM ENDPOINTS (TeamApi)
  # ═══════════════════════════════════════════════════════════════
  /teams:
    get:
      tags: [Teams]
      summary: Get user's teams
      operationId: getTeams
      responses:
        '200':
          description: Team list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Team'
    post:
      tags: [Teams]
      summary: Create team
      operationId: createTeam
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                description:
                  type: string
                teamsWebhookUrl:
                  type: string
      responses:
        '200':
          description: Created team
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'

  /teams/{teamId}:
    get:
      tags: [Teams]
      summary: Get team
      operationId: getTeam
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Team
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
    put:
      tags: [Teams]
      summary: Update team
      operationId: updateTeam
      parameters:
        - $ref: '#/components/parameters/teamId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                teamsWebhookUrl:
                  type: string
      responses:
        '200':
          description: Updated team
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'
    delete:
      tags: [Teams]
      summary: Delete team
      operationId: deleteTeam
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '204':
          description: Deleted

  /teams/{teamId}/members:
    get:
      tags: [Teams]
      summary: Get team members
      operationId: getTeamMembers
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Member list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TeamMember'

  /teams/{teamId}/members/{userId}/role:
    put:
      tags: [Teams]
      summary: Update member role
      operationId: updateMemberRole
      parameters:
        - $ref: '#/components/parameters/teamId'
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  $ref: '#/components/schemas/TeamRole'
      responses:
        '200':
          description: Updated member
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamMember'

  /teams/{teamId}/members/{userId}:
    delete:
      tags: [Teams]
      summary: Remove member
      operationId: removeMember
      parameters:
        - $ref: '#/components/parameters/teamId'
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Removed

  /teams/{teamId}/invitations:
    post:
      tags: [Teams]
      summary: Invite member
      operationId: inviteMember
      parameters:
        - $ref: '#/components/parameters/teamId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, role]
              properties:
                email:
                  type: string
                  format: email
                role:
                  $ref: '#/components/schemas/TeamRole'
      responses:
        '200':
          description: Invitation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invitation'
    get:
      tags: [Teams]
      summary: Get pending invitations
      operationId: getTeamInvitations
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Invitation list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Invitation'

  /teams/{teamId}/invitations/{invitationId}:
    delete:
      tags: [Teams]
      summary: Cancel invitation
      operationId: cancelInvitation
      parameters:
        - $ref: '#/components/parameters/teamId'
        - name: invitationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Cancelled

  /teams/invitations/{token}/accept:
    post:
      tags: [Teams]
      summary: Accept invitation
      operationId: acceptInvitation
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Joined team
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Team'

  # ═══════════════════════════════════════════════════════════════
  # PROJECT ENDPOINTS (ProjectApi)
  # ═══════════════════════════════════════════════════════════════
  /projects/{teamId}:
    post:
      tags: [Projects]
      summary: Create project
      operationId: createProject
      parameters:
        - $ref: '#/components/parameters/teamId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '200':
          description: Created project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'

  /projects/team/{teamId}:
    get:
      tags: [Projects]
      summary: Get team projects
      operationId: getTeamProjects
      parameters:
        - $ref: '#/components/parameters/teamId'
        - name: includeArchived
          in: query
          schema:
            type: boolean
        - name: size
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: Project list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'

  /projects/team/{teamId}/paged:
    get:
      tags: [Projects]
      summary: Get team projects (paginated)
      operationId: getTeamProjectsPaged
      parameters:
        - $ref: '#/components/parameters/teamId'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
        - name: includeArchived
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Paginated projects
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseProject'

  /projects/{projectId}:
    get:
      tags: [Projects]
      summary: Get project
      operationId: getProject
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
    put:
      tags: [Projects]
      summary: Update project
      operationId: updateProject
      parameters:
        - $ref: '#/components/parameters/projectId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProjectRequest'
      responses:
        '200':
          description: Updated project
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
    delete:
      tags: [Projects]
      summary: Delete project
      operationId: deleteProject
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '204':
          description: Deleted

  /projects/{projectId}/archive:
    put:
      tags: [Projects]
      summary: Archive project
      operationId: archiveProject
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Archived

  /projects/{projectId}/unarchive:
    put:
      tags: [Projects]
      summary: Unarchive project
      operationId: unarchiveProject
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Unarchived

  # ═══════════════════════════════════════════════════════════════
  # JOB ENDPOINTS (JobApi)
  # ═══════════════════════════════════════════════════════════════
  /jobs:
    post:
      tags: [Jobs]
      summary: Create QA job
      operationId: createJob
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJobRequest'
      responses:
        '200':
          description: Created job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QaJob'

  /jobs/{jobId}:
    get:
      tags: [Jobs]
      summary: Get job
      operationId: getJob
      parameters:
        - $ref: '#/components/parameters/jobId'
      responses:
        '200':
          description: Job detail
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QaJob'
    put:
      tags: [Jobs]
      summary: Update job
      operationId: updateJob
      parameters:
        - $ref: '#/components/parameters/jobId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateJobRequest'
      responses:
        '200':
          description: Updated job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QaJob'
    delete:
      tags: [Jobs]
      summary: Delete job
      operationId: deleteJob
      parameters:
        - $ref: '#/components/parameters/jobId'
      responses:
        '204':
          description: Deleted

  /jobs/project/{projectId}:
    get:
      tags: [Jobs]
      summary: Get project jobs
      operationId: getProjectJobs
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
      responses:
        '200':
          description: Paginated job summaries
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseJobSummary'

  /jobs/mine:
    get:
      tags: [Jobs]
      summary: Get my recent jobs
      operationId: getMyJobs
      responses:
        '200':
          description: Job summary list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobSummary'

  /jobs/{jobId}/agents:
    post:
      tags: [Jobs]
      summary: Create agent run
      operationId: createAgentRun
      parameters:
        - $ref: '#/components/parameters/jobId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [agentType]
              properties:
                agentType:
                  $ref: '#/components/schemas/AgentType'
      responses:
        '200':
          description: Created agent run
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentRun'
    get:
      tags: [Jobs]
      summary: Get agent runs for job
      operationId: getAgentRuns
      parameters:
        - $ref: '#/components/parameters/jobId'
      responses:
        '200':
          description: Agent run list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AgentRun'

  /jobs/{jobId}/agents/batch:
    post:
      tags: [Jobs]
      summary: Create agent runs (batch)
      operationId: createAgentRunsBatch
      parameters:
        - $ref: '#/components/parameters/jobId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [agentTypes]
              properties:
                agentTypes:
                  type: array
                  items:
                    $ref: '#/components/schemas/AgentType'
      responses:
        '200':
          description: Created agent runs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AgentRun'

  /jobs/agents/{agentRunId}:
    put:
      tags: [Jobs]
      summary: Update agent run
      operationId: updateAgentRun
      parameters:
        - name: agentRunId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentRunRequest'
      responses:
        '200':
          description: Updated agent run
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentRun'

  /jobs/{jobId}/investigation:
    post:
      tags: [Jobs]
      summary: Create bug investigation
      operationId: createInvestigation
      parameters:
        - $ref: '#/components/parameters/jobId'
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInvestigationRequest'
      responses:
        '200':
          description: Created investigation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BugInvestigation'
    get:
      tags: [Jobs]
      summary: Get bug investigation
      operationId: getInvestigation
      parameters:
        - $ref: '#/components/parameters/jobId'
      responses:
        '200':
          description: Investigation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BugInvestigation'

  /jobs/investigations/{investigationId}:
    put:
      tags: [Jobs]
      summary: Update investigation
      operationId: updateInvestigation
      parameters:
        - name: investigationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateInvestigationRequest'
      responses:
        '200':
          description: Updated investigation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BugInvestigation'

  # ═══════════════════════════════════════════════════════════════
  # FINDING ENDPOINTS (FindingApi)
  # ═══════════════════════════════════════════════════════════════
  /findings:
    post:
      tags: [Findings]
      summary: Create finding
      operationId: createFinding
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFindingRequest'
      responses:
        '200':
          description: Created finding
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Finding'

  /findings/batch:
    post:
      tags: [Findings]
      summary: Create findings (batch)
      operationId: createFindingsBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CreateFindingRequest'
      responses:
        '200':
          description: Created findings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Finding'

  /findings/job/{jobId}:
    get:
      tags: [Findings]
      summary: Get findings for job (paginated)
      operationId: getJobFindings
      parameters:
        - $ref: '#/components/parameters/jobId'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
      responses:
        '200':
          description: Paginated findings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageResponseFinding'

  /findings/job/{jobId}/severity-counts:
    get:
      tags: [Findings]
      summary: Get severity counts
      operationId: getSeverityCounts
      parameters:
        - $ref: '#/components/parameters/jobId'
      responses:
        '200':
          description: Severity count map
          content:
            application/json:
              schema:
                type: object
                additionalProperties:
                  type: integer

  /findings/{findingId}:
    get:
      tags: [Findings]
      summary: Get finding
      operationId: getFinding
      parameters:
        - name: findingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Finding
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Finding'

  /findings/{findingId}/status:
    put:
      tags: [Findings]
      summary: Update finding status
      operationId: updateFindingStatus
      parameters:
        - name: findingId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  $ref: '#/components/schemas/FindingStatus'
      responses:
        '200':
          description: Updated finding
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Finding'

  # ═══════════════════════════════════════════════════════════════
  # TASK ENDPOINTS (TaskApi)
  # ═══════════════════════════════════════════════════════════════
  /tasks:
    post:
      tags: [Tasks]
      summary: Create task
      operationId: createTask
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '200':
          description: Created task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationTask'

  /tasks/batch:
    post:
      tags: [Tasks]
      summary: Create tasks (batch)
      operationId: createTasksBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/CreateTaskRequest'
      responses:
        '200':
          description: Created tasks
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RemediationTask'

  /tasks/job/{jobId}:
    get:
      tags: [Tasks]
      summary: Get tasks for job
      operationId: getJobTasks
      parameters:
        - $ref: '#/components/parameters/jobId'
      responses:
        '200':
          description: Task list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RemediationTask'

  /tasks/{taskId}:
    get:
      tags: [Tasks]
      summary: Get task
      operationId: getTask
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationTask'
    put:
      tags: [Tasks]
      summary: Update task
      operationId: updateTask
      parameters:
        - name: taskId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  $ref: '#/components/schemas/TaskStatus'
                assignedTo:
                  type: string
                  format: uuid
                jiraKey:
                  type: string
      responses:
        '200':
          description: Updated task
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationTask'

  /tasks/assigned-to-me:
    get:
      tags: [Tasks]
      summary: Get my assigned tasks
      operationId: getMyTasks
      responses:
        '200':
          description: Task list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RemediationTask'

  # ═══════════════════════════════════════════════════════════════
  # PERSONA ENDPOINTS (PersonaApi)
  # ═══════════════════════════════════════════════════════════════
  /personas:
    post:
      tags: [Personas]
      summary: Create persona
      operationId: createPersona
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePersonaRequest'
      responses:
        '200':
          description: Created persona
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Persona'

  /personas/{personaId}:
    get:
      tags: [Personas]
      summary: Get persona
      operationId: getPersona
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Persona
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Persona'
    put:
      tags: [Personas]
      summary: Update persona
      operationId: updatePersona
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                contentMd:
                  type: string
                isDefault:
                  type: boolean
      responses:
        '200':
          description: Updated persona
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Persona'
    delete:
      tags: [Personas]
      summary: Delete persona
      operationId: deletePersona
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Deleted

  /personas/team/{teamId}:
    get:
      tags: [Personas]
      summary: Get team personas
      operationId: getTeamPersonas
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Persona list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Persona'

  /personas/system:
    get:
      tags: [Personas]
      summary: Get system personas
      operationId: getSystemPersonas
      responses:
        '200':
          description: System persona list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Persona'

  /personas/mine:
    get:
      tags: [Personas]
      summary: Get my personas
      operationId: getMyPersonas
      responses:
        '200':
          description: User persona list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Persona'

  /personas/{personaId}/set-default:
    put:
      tags: [Personas]
      summary: Set as default
      operationId: setPersonaDefault
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Updated persona
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Persona'

  /personas/{personaId}/remove-default:
    put:
      tags: [Personas]
      summary: Remove default
      operationId: removePersonaDefault
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Updated persona
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Persona'

  # ═══════════════════════════════════════════════════════════════
  # METRICS ENDPOINTS (MetricsApi)
  # ═══════════════════════════════════════════════════════════════
  /metrics/team/{teamId}:
    get:
      tags: [Metrics]
      summary: Get team metrics
      operationId: getTeamMetrics
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Team metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamMetrics'

  /metrics/project/{projectId}:
    get:
      tags: [Metrics]
      summary: Get project metrics
      operationId: getProjectMetrics
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Project metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectMetrics'

  /metrics/project/{projectId}/trend:
    get:
      tags: [Metrics]
      summary: Get health trend
      operationId: getProjectTrend
      parameters:
        - $ref: '#/components/parameters/projectId'
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: Health snapshots
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HealthSnapshot'

  # ═══════════════════════════════════════════════════════════════
  # REPORT ENDPOINTS (ReportApi)
  # ═══════════════════════════════════════════════════════════════
  /reports/job/{jobId}/summary:
    post:
      tags: [Reports]
      summary: Upload summary report
      operationId: uploadSummaryReport
      parameters:
        - $ref: '#/components/parameters/jobId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [content]
              properties:
                content:
                  type: string
      responses:
        '200':
          description: Upload result with S3 key

  /reports/job/{jobId}/agent/{agentType}:
    post:
      tags: [Reports]
      summary: Upload agent report
      operationId: uploadAgentReport
      parameters:
        - $ref: '#/components/parameters/jobId'
        - name: agentType
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/AgentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [reportJson]
              properties:
                reportJson:
                  type: string
      responses:
        '200':
          description: Upload result with S3 key

  /reports/download:
    get:
      tags: [Reports]
      summary: Download report
      operationId: downloadReport
      parameters:
        - name: s3Key
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Report content

  # ═══════════════════════════════════════════════════════════════
  # REMAINING CODEOPS-SERVER ENDPOINTS
  # (Compliance, Dependency, Directive, HealthMonitor,
  #  Integration, Admin, TechDebt, Anthropic)
  # Documented in summary form — full detail in API service files
  # ═══════════════════════════════════════════════════════════════

  # ComplianceApi (5 endpoints)
  /compliance/job/{jobId}:
    get:
      tags: [Compliance]
      summary: Get compliance items for job
      operationId: getComplianceItems
      parameters:
        - $ref: '#/components/parameters/jobId'
      responses:
        '200':
          description: Compliance items

  /compliance:
    post:
      tags: [Compliance]
      summary: Create compliance item
      operationId: createComplianceItem
      responses:
        '200':
          description: Created item

  /compliance/batch:
    post:
      tags: [Compliance]
      summary: Create compliance items (batch)
      operationId: createComplianceItemsBatch
      responses:
        '200':
          description: Created items

  # DependencyApi (6 endpoints)
  /dependencies/project/{projectId}:
    get:
      tags: [Dependencies]
      summary: Get dependency scans
      operationId: getDependencyScans
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Scan list

  # DirectiveApi (7 endpoints)
  /directives:
    post:
      tags: [Directives]
      summary: Create directive
      operationId: createDirective
      responses:
        '200':
          description: Created directive

  /directives/team/{teamId}:
    get:
      tags: [Directives]
      summary: Get team directives
      operationId: getTeamDirectives
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Directive list

  # HealthMonitorApi (6 endpoints)
  /health-monitor/snapshots/project/{projectId}:
    get:
      tags: [HealthMonitor]
      summary: Get health snapshots
      operationId: getHealthSnapshots
      parameters:
        - $ref: '#/components/parameters/projectId'
      responses:
        '200':
          description: Snapshot list

  # IntegrationApi (8 endpoints)
  /integrations/github/{teamId}:
    get:
      tags: [Integrations]
      summary: Get GitHub connections
      operationId: getGitHubConnections
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Connection list

  /integrations/jira/{teamId}:
    get:
      tags: [Integrations]
      summary: Get Jira connections
      operationId: getJiraConnections
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Connection list

  # AdminApi (9 endpoints)
  /admin/team/{teamId}/members:
    get:
      tags: [Admin]
      summary: Get team members (admin)
      operationId: getAdminTeamMembers
      parameters:
        - $ref: '#/components/parameters/teamId'
      responses:
        '200':
          description: Member list

  # TechDebtApi (9 endpoints)
  /tech-debt:
    post:
      tags: [TechDebt]
      summary: Create tech debt item
      operationId: createTechDebtItem
      responses:
        '200':
          description: Created item

  /tech-debt/project/{projectId}:
    get:
      tags: [TechDebt]
      summary: Get project tech debt
      operationId: getProjectTechDebt
      parameters:
        - $ref: '#/components/parameters/projectId'
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
      responses:
        '200':
          description: Paginated tech debt items

  # AnthropicApiService (2 endpoints)
  /anthropic/models:
    get:
      tags: [Anthropic]
      summary: List available models
      operationId: listModels
      responses:
        '200':
          description: Model list

  # ═══════════════════════════════════════════════════════════════
  # VAULT ENDPOINTS (VaultApi — 67 endpoints)
  # Base URL: http://localhost:8097/api/v1/vault
  # ═══════════════════════════════════════════════════════════════

  # Secrets (19 endpoints)
  /secrets:
    get:
      tags: [Vault - Secrets]
      summary: List secrets (paginated, filtered)
      operationId: listSecrets
      parameters:
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/SecretType'
        - name: pathPrefix
          in: query
          schema:
            type: string
        - name: activeOnly
          in: query
          schema:
            type: boolean
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
      responses:
        '200':
          description: Paginated secrets
    post:
      tags: [Vault - Secrets]
      summary: Create secret
      operationId: createSecret
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSecretRequest'
      responses:
        '200':
          description: Created secret
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'

  /secrets/{secretId}:
    get:
      tags: [Vault - Secrets]
      summary: Get secret metadata
      operationId: getSecret
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Secret metadata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretResponse'
    put:
      tags: [Vault - Secrets]
      summary: Update secret
      operationId: updateSecret
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Updated secret
    delete:
      tags: [Vault - Secrets]
      summary: Soft delete secret
      operationId: softDeleteSecret
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Soft deleted

  /secrets/{secretId}/value:
    get:
      tags: [Vault - Secrets]
      summary: Read decrypted secret value
      operationId: readSecretValue
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Decrypted value
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecretValueResponse'

  /secrets/{secretId}/versions:
    get:
      tags: [Vault - Secrets]
      summary: List secret versions
      operationId: listVersions
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
      responses:
        '200':
          description: Paginated versions

  /secrets/search:
    get:
      tags: [Vault - Secrets]
      summary: Search secrets
      operationId: searchSecrets
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Search results

  /secrets/stats:
    get:
      tags: [Vault - Secrets]
      summary: Get secret statistics
      operationId: getSecretStats
      responses:
        '200':
          description: Stats map

  /secrets/expiring:
    get:
      tags: [Vault - Secrets]
      summary: Get expiring secrets
      operationId: getExpiringSecrets
      parameters:
        - name: withinHours
          in: query
          schema:
            type: integer
            default: 72
      responses:
        '200':
          description: Expiring secret list

  # Policies (12 endpoints)
  /policies:
    get:
      tags: [Vault - Policies]
      summary: List policies
      operationId: listPolicies
      responses:
        '200':
          description: Paginated policies
    post:
      tags: [Vault - Policies]
      summary: Create policy
      operationId: createPolicy
      responses:
        '200':
          description: Created policy

  /policies/{policyId}:
    get:
      tags: [Vault - Policies]
      summary: Get policy
      operationId: getPolicy
      parameters:
        - name: policyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Policy detail
    put:
      tags: [Vault - Policies]
      summary: Update policy
      operationId: updatePolicy
      parameters:
        - name: policyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Updated policy
    delete:
      tags: [Vault - Policies]
      summary: Delete policy
      operationId: deletePolicy
      parameters:
        - name: policyId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Deleted

  /policies/evaluate:
    post:
      tags: [Vault - Policies]
      summary: Evaluate access
      operationId: evaluateAccess
      responses:
        '200':
          description: Access decision

  # Rotation (8 endpoints)
  /rotation/policies:
    post:
      tags: [Vault - Rotation]
      summary: Create rotation policy
      operationId: createRotationPolicy
      responses:
        '200':
          description: Created rotation policy

  /rotation/rotate/{secretId}:
    post:
      tags: [Vault - Rotation]
      summary: Rotate secret
      operationId: rotateSecret
      parameters:
        - name: secretId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Rotation result

  # Transit (12 endpoints)
  /transit/keys:
    get:
      tags: [Vault - Transit]
      summary: List transit keys
      operationId: listTransitKeys
      responses:
        '200':
          description: Paginated keys
    post:
      tags: [Vault - Transit]
      summary: Create transit key
      operationId: createTransitKey
      responses:
        '200':
          description: Created key

  /transit/encrypt:
    post:
      tags: [Vault - Transit]
      summary: Encrypt data
      operationId: transitEncrypt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [keyName, plaintext]
              properties:
                keyName:
                  type: string
                plaintext:
                  type: string
      responses:
        '200':
          description: Ciphertext
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitEncryptResponse'

  /transit/decrypt:
    post:
      tags: [Vault - Transit]
      summary: Decrypt data
      operationId: transitDecrypt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [keyName, ciphertext]
              properties:
                keyName:
                  type: string
                ciphertext:
                  type: string
      responses:
        '200':
          description: Plaintext
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransitDecryptResponse'

  # Dynamic Secrets (7 endpoints)
  /dynamic/leases:
    get:
      tags: [Vault - Dynamic]
      summary: List leases
      operationId: listDynamicLeases
      parameters:
        - name: secretId
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Paginated leases
    post:
      tags: [Vault - Dynamic]
      summary: Create lease
      operationId: createDynamicLease
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [secretId, ttlSeconds]
              properties:
                secretId:
                  type: string
                  format: uuid
                ttlSeconds:
                  type: integer
      responses:
        '200':
          description: Created lease

  # Seal (5 endpoints)
  /seal/status:
    get:
      tags: [Vault - Seal]
      summary: Get seal status
      operationId: getSealStatus
      security: []
      responses:
        '200':
          description: Seal status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SealStatusResponse'

  /seal/seal:
    post:
      tags: [Vault - Seal]
      summary: Seal vault
      operationId: sealVault
      responses:
        '200':
          description: Sealed status

  /seal/unseal:
    post:
      tags: [Vault - Seal]
      summary: Unseal vault
      operationId: unsealVault
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                action:
                  type: string
                keyShare:
                  type: string
      responses:
        '200':
          description: Updated seal status

  # Audit (3 endpoints)
  /audit/query:
    get:
      tags: [Vault - Audit]
      summary: Query audit log
      operationId: queryAuditLog
      parameters:
        - name: operation
          in: query
          schema:
            type: string
        - name: resourceType
          in: query
          schema:
            type: string
        - name: successOnly
          in: query
          schema:
            type: boolean
        - $ref: '#/components/parameters/page'
        - $ref: '#/components/parameters/size'
      responses:
        '200':
          description: Paginated audit entries

  /audit/stats:
    get:
      tags: [Vault - Audit]
      summary: Get audit statistics
      operationId: getAuditStats
      responses:
        '200':
          description: Stats map

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    teamId:
      name: teamId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    projectId:
      name: projectId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    jobId:
      name: jobId
      in: path
      required: true
      schema:
        type: string
        format: uuid
    page:
      name: page
      in: query
      schema:
        type: integer
        default: 0
    size:
      name: size
      in: query
      schema:
        type: integer
        default: 20

  schemas:
    # ══════════════════════════════════════════════════════════════
    # ENUMS
    # ══════════════════════════════════════════════════════════════
    AgentType:
      type: string
      enum: [SECURITY, CODE_QUALITY, BUILD_HEALTH, COMPLETENESS, API_CONTRACT, TEST_COVERAGE, UI_UX, DOCUMENTATION, DATABASE, PERFORMANCE, DEPENDENCY, ARCHITECTURE]

    JobMode:
      type: string
      enum: [FULL_AUDIT, TARGETED, COMPLIANCE, BUG_INVESTIGATION]

    JobStatus:
      type: string
      enum: [PENDING, RUNNING, COMPLETED, FAILED, CANCELLED]

    JobResult:
      type: string
      enum: [PASS, WARN, FAIL]

    AgentStatus:
      type: string
      enum: [PENDING, RUNNING, COMPLETED, FAILED, TIMED_OUT]

    AgentResult:
      type: string
      enum: [PASS, WARN, FAIL]

    Severity:
      type: string
      enum: [CRITICAL, HIGH, MEDIUM, LOW]

    FindingStatus:
      type: string
      enum: [OPEN, ACKNOWLEDGED, FALSE_POSITIVE, RESOLVED]

    Priority:
      type: string
      enum: [P0, P1, P2, P3]

    TaskStatus:
      type: string
      enum: [PENDING, ASSIGNED, EXPORTED, JIRA_CREATED, COMPLETED]

    Scope:
      type: string
      enum: [SYSTEM, TEAM, USER]

    TeamRole:
      type: string
      enum: [OWNER, ADMIN, LEAD, MEMBER]

    InvitationStatus:
      type: string
      enum: [PENDING, ACCEPTED, DECLINED, EXPIRED, CANCELLED]

    DebtCategory:
      type: string
      enum: [ARCHITECTURE, CODE_SMELL, DEPENDENCY, DOCUMENTATION, PERFORMANCE, SECURITY, TEST_COVERAGE]

    DebtStatus:
      type: string
      enum: [IDENTIFIED, PLANNED, IN_PROGRESS, RESOLVED]

    SecretType:
      type: string
      enum: [STATIC, DYNAMIC, REFERENCE]

    SealStatus:
      type: string
      enum: [SEALED, UNSEALED, UNSEALING]

    PolicyPermission:
      type: string
      enum: [READ, WRITE, DELETE, LIST, ROTATE]

    BindingType:
      type: string
      enum: [USER, TEAM, SERVICE]

    RotationStrategy:
      type: string
      enum: [RANDOM_GENERATE, EXTERNAL_API, CUSTOM_SCRIPT]

    LeaseStatus:
      type: string
      enum: [ACTIVE, EXPIRED, REVOKED]

    # ══════════════════════════════════════════════════════════════
    # CORE MODELS
    # ══════════════════════════════════════════════════════════════
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        displayName:
          type: string
        avatarUrl:
          type: string
        isActive:
          type: boolean
        lastLoginAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    Team:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        ownerId:
          type: string
          format: uuid
        ownerName:
          type: string
        teamsWebhookUrl:
          type: string
        memberCount:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    TeamMember:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        displayName:
          type: string
        email:
          type: string
          format: email
        avatarUrl:
          type: string
        role:
          $ref: '#/components/schemas/TeamRole'
        joinedAt:
          type: string
          format: date-time

    Invitation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        role:
          $ref: '#/components/schemas/TeamRole'
        status:
          $ref: '#/components/schemas/InvitationStatus'
        invitedByName:
          type: string
        expiresAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        githubConnectionId:
          type: string
          format: uuid
        repoUrl:
          type: string
        repoFullName:
          type: string
        defaultBranch:
          type: string
        jiraConnectionId:
          type: string
          format: uuid
        jiraProjectKey:
          type: string
        jiraDefaultIssueType:
          type: string
        jiraLabels:
          type: array
          items:
            type: string
        jiraComponent:
          type: string
        techStack:
          type: string
        healthScore:
          type: integer
        lastAuditAt:
          type: string
          format: date-time
        isArchived:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    QaJob:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        projectName:
          type: string
        mode:
          $ref: '#/components/schemas/JobMode'
        status:
          $ref: '#/components/schemas/JobStatus'
        name:
          type: string
        branch:
          type: string
        configJson:
          type: string
        summaryMd:
          type: string
        overallResult:
          $ref: '#/components/schemas/JobResult'
        healthScore:
          type: integer
        totalFindings:
          type: integer
        criticalCount:
          type: integer
        highCount:
          type: integer
        mediumCount:
          type: integer
        lowCount:
          type: integer
        jiraTicketKey:
          type: string
        startedBy:
          type: string
          format: uuid
        startedByName:
          type: string
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    JobSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectName:
          type: string
        mode:
          $ref: '#/components/schemas/JobMode'
        status:
          $ref: '#/components/schemas/JobStatus'
        name:
          type: string
        overallResult:
          $ref: '#/components/schemas/JobResult'
        healthScore:
          type: integer
        totalFindings:
          type: integer
        criticalCount:
          type: integer
        completedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    AgentRun:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        agentType:
          $ref: '#/components/schemas/AgentType'
        status:
          $ref: '#/components/schemas/AgentStatus'
        result:
          $ref: '#/components/schemas/AgentResult'
        reportS3Key:
          type: string
        score:
          type: integer
        findingsCount:
          type: integer
        criticalCount:
          type: integer
        highCount:
          type: integer
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time

    Finding:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        agentType:
          $ref: '#/components/schemas/AgentType'
        severity:
          $ref: '#/components/schemas/Severity'
        title:
          type: string
        description:
          type: string
        filePath:
          type: string
        lineNumber:
          type: integer
        recommendation:
          type: string
        evidence:
          type: string
        effortEstimate:
          type: string
        debtCategory:
          type: string
        findingStatus:
          $ref: '#/components/schemas/FindingStatus'
        statusChangedBy:
          type: string
          format: uuid
        statusChangedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    RemediationTask:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        taskNumber:
          type: integer
        title:
          type: string
        description:
          type: string
        promptMd:
          type: string
        promptS3Key:
          type: string
        findingIds:
          type: array
          items:
            type: string
            format: uuid
        priority:
          $ref: '#/components/schemas/Priority'
        status:
          $ref: '#/components/schemas/TaskStatus'
        assignedTo:
          type: string
          format: uuid
        assignedToName:
          type: string
        jiraKey:
          type: string
        createdAt:
          type: string
          format: date-time

    Persona:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        agentType:
          $ref: '#/components/schemas/AgentType'
        description:
          type: string
        contentMd:
          type: string
        scope:
          $ref: '#/components/schemas/Scope'
        teamId:
          type: string
          format: uuid
        createdBy:
          type: string
          format: uuid
        createdByName:
          type: string
        isDefault:
          type: boolean
        version:
          type: integer
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    HealthSnapshot:
      type: object
      properties:
        id:
          type: string
          format: uuid
        projectId:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        healthScore:
          type: integer
        findingsBySeverity:
          type: object
          additionalProperties:
            type: integer
        techDebtScore:
          type: integer
        dependencyScore:
          type: integer
        testCoveragePercent:
          type: number
          format: double
        capturedAt:
          type: string
          format: date-time

    TeamMetrics:
      type: object
      properties:
        totalProjects:
          type: integer
        totalJobs:
          type: integer
        averageHealthScore:
          type: number
        totalFindings:
          type: integer
        openFindings:
          type: integer

    ProjectMetrics:
      type: object
      properties:
        projectId:
          type: string
          format: uuid
        healthScore:
          type: integer
        previousHealthScore:
          type: integer
        totalJobs:
          type: integer
        totalFindings:
          type: integer
        openFindings:
          type: integer

    BugInvestigation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        jobId:
          type: string
          format: uuid
        jiraKey:
          type: string
        jiraSummary:
          type: string
        rcaMd:
          type: string
        impactAssessmentMd:
          type: string
        rcaS3Key:
          type: string
        rcaPostedToJira:
          type: boolean
        fixTasksCreatedInJira:
          type: boolean
        createdAt:
          type: string
          format: date-time

    # ══════════════════════════════════════════════════════════════
    # VAULT MODELS
    # ══════════════════════════════════════════════════════════════
    SecretResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        teamId:
          type: string
          format: uuid
        path:
          type: string
        name:
          type: string
        description:
          type: string
        secretType:
          $ref: '#/components/schemas/SecretType'
        currentVersion:
          type: integer
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    SecretValueResponse:
      type: object
      properties:
        secretId:
          type: string
          format: uuid
        path:
          type: string
        name:
          type: string
        versionNumber:
          type: integer
        value:
          type: string
        createdAt:
          type: string
          format: date-time

    SealStatusResponse:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/SealStatus'
        totalShares:
          type: integer
        threshold:
          type: integer
        sharesProvided:
          type: integer
        autoUnsealEnabled:
          type: boolean
        sealedAt:
          type: string
          format: date-time
        unsealedAt:
          type: string
          format: date-time

    TransitEncryptResponse:
      type: object
      properties:
        keyName:
          type: string
        keyVersion:
          type: integer
        ciphertext:
          type: string

    TransitDecryptResponse:
      type: object
      properties:
        keyName:
          type: string
        plaintext:
          type: string

    # ══════════════════════════════════════════════════════════════
    # REQUEST MODELS
    # ══════════════════════════════════════════════════════════════
    CreateProjectRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        githubConnectionId:
          type: string
          format: uuid
        repoUrl:
          type: string
        repoFullName:
          type: string
        defaultBranch:
          type: string
        jiraConnectionId:
          type: string
          format: uuid
        jiraProjectKey:
          type: string
        jiraDefaultIssueType:
          type: string
        jiraLabels:
          type: array
          items:
            type: string
        jiraComponent:
          type: string
        techStack:
          type: string

    CreateJobRequest:
      type: object
      required: [projectId, mode]
      properties:
        projectId:
          type: string
          format: uuid
        mode:
          $ref: '#/components/schemas/JobMode'
        name:
          type: string
        branch:
          type: string
        configJson:
          type: string
        jiraTicketKey:
          type: string

    UpdateJobRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/JobStatus'
        summaryMd:
          type: string
        overallResult:
          $ref: '#/components/schemas/JobResult'
        healthScore:
          type: integer
        totalFindings:
          type: integer
        criticalCount:
          type: integer
        highCount:
          type: integer
        mediumCount:
          type: integer
        lowCount:
          type: integer
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time

    UpdateAgentRunRequest:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/AgentStatus'
        result:
          $ref: '#/components/schemas/AgentResult'
        reportS3Key:
          type: string
        score:
          type: integer
        findingsCount:
          type: integer
        criticalCount:
          type: integer
        highCount:
          type: integer
        startedAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time

    CreateFindingRequest:
      type: object
      required: [jobId, agentType, severity, title]
      properties:
        jobId:
          type: string
          format: uuid
        agentType:
          $ref: '#/components/schemas/AgentType'
        severity:
          $ref: '#/components/schemas/Severity'
        title:
          type: string
        description:
          type: string
        filePath:
          type: string
        lineNumber:
          type: integer
        recommendation:
          type: string
        evidence:
          type: string
        effortEstimate:
          type: string
        debtCategory:
          type: string

    CreateTaskRequest:
      type: object
      required: [jobId, taskNumber, title]
      properties:
        jobId:
          type: string
          format: uuid
        taskNumber:
          type: integer
        title:
          type: string
        description:
          type: string
        promptMd:
          type: string
        promptS3Key:
          type: string
        findingIds:
          type: array
          items:
            type: string
            format: uuid
        priority:
          $ref: '#/components/schemas/Priority'

    CreatePersonaRequest:
      type: object
      required: [name, contentMd, scope]
      properties:
        name:
          type: string
        contentMd:
          type: string
        scope:
          $ref: '#/components/schemas/Scope'
        agentType:
          $ref: '#/components/schemas/AgentType'
        description:
          type: string
        teamId:
          type: string
          format: uuid
        isDefault:
          type: boolean

    CreateInvestigationRequest:
      type: object
      properties:
        jiraKey:
          type: string
        jiraSummary:
          type: string
        jiraDescription:
          type: string
        jiraCommentsJson:
          type: string
        jiraAttachmentsJson:
          type: string
        jiraLinkedIssues:
          type: string
        additionalContext:
          type: string

    UpdateInvestigationRequest:
      type: object
      properties:
        rcaMd:
          type: string
        impactAssessmentMd:
          type: string
        rcaS3Key:
          type: string
        rcaPostedToJira:
          type: boolean
        fixTasksCreatedInJira:
          type: boolean

    CreateSecretRequest:
      type: object
      required: [path, name, value, secretType]
      properties:
        path:
          type: string
        name:
          type: string
        value:
          type: string
        secretType:
          $ref: '#/components/schemas/SecretType'
        description:
          type: string
        referenceArn:
          type: string
        maxVersions:
          type: integer
        retentionDays:
          type: integer
        expiresAt:
          type: string
          format: date-time
        metadata:
          type: object
          additionalProperties:
            type: string

    # ══════════════════════════════════════════════════════════════
    # PAGINATION
    # ══════════════════════════════════════════════════════════════
    PageResponseProject:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Project'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        number:
          type: integer
        size:
          type: integer

    PageResponseJobSummary:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/JobSummary'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        number:
          type: integer
        size:
          type: integer

    PageResponseFinding:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Finding'
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        number:
          type: integer
        size:
          type: integer
